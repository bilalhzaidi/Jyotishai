"""Psychological vulnerability analysis module for JyotishAI.

This module considers the Moon sign to highlight emotional needs and
potential vulnerabilities.  The advice is framed to encourage self‑awareness
and resilience within legal and professional settings.
"""

from fastapi import APIRouter

from models.schemas import ChartRequest, ModuleResult, ModuleName
from services.chart_engine import VedicAstrologyEngine

router = APIRouter()

MOON_DESCRIPTIONS = {
    "ARIES": "Can be impulsive in emotional responses; benefits from cultivating patience.",
    "TAURUS": "May resist change; needs security but should avoid stagnation.",
    "GEMINI": "Prone to anxiety from overthinking; grounding practices are helpful.",
    "CANCER": "Highly sensitive; must protect against absorbing others' emotions.",
    "LEO": "Seeks validation; should balance self‑expression with humility.",
    "VIRGO": "May become overly critical; nurturing self‑compassion is key.",
    "LIBRA": "Fears discord; needs to assert personal needs while maintaining harmony.",
    "SCORPIO": "Intense emotions; should monitor tendencies toward jealousy or secrecy.",
    "SAGITTARIUS": "Avoids constraints; benefits from committing to responsibilities.",
    "CAPRICORN": "Emotionally reserved; must allow vulnerability and seek support when needed.",
    "AQUARIUS": "Detached at times; needs to integrate emotions with intellect.",
    "PISCES": "Absorbs collective feelings; requires clear boundaries and grounding."
}


def analyze_psychological(chart):
    moon = chart.moon_sign
    desc = MOON_DESCRIPTIONS.get(moon, "The Moon reflects emotional needs and patterns.")
    analysis = (
        f"The Moon resides in {moon}.  " + desc +
        "  Recognising these tendencies allows for proactive management of stress and maintains professional composure."
    )
    return analysis


@router.post("", response_model=ModuleResult)
def psychological_endpoint(request: ChartRequest) -> ModuleResult:
    chart = VedicAstrologyEngine.from_request(request)
    analysis = analyze_psychological(chart)
    return ModuleResult(module=ModuleName.PSYCHOLOGICAL, analysis=analysis)